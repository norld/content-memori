# Content Memori - Supabase Integration

A Next.js content ideas management application with Supabase backend integration and OTP authentication.

## Features

- **OTP Authentication**: Email-based magic link authentication using Supabase Auth
- **Idea Management**: Create, read, update, and delete content ideas
- **Real-time Updates**: Automatic real-time sync across all connected clients
- **User-specific Data**: Each user only sees their own ideas (Row Level Security)
- **Responsive Design**: Beautiful dark mode UI with glass morphism effects

## Setup Instructions

### 1. Configure Supabase

1. Go to your Supabase project dashboard: https://supabase.com/dashboard/project/zxljscuouoszogzqzuvl
2. Navigate to **Settings** → **API**
3. Copy your project URL and anon key

### 2. Set Environment Variables

Create a `.env.local` file in the root directory:

```bash
cp .env.local.example .env.local
```

Update `.env.local` with your Supabase credentials:

```env
NEXT_PUBLIC_SUPABASE_URL=https://zxljscuouoszogzqzuvl.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
```

### 3. Run Database Migration

In your Supabase dashboard:
1. Navigate to **SQL Editor**
2. Run the SQL from `supabase-schema.sql`:

```sql
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create ideas table with user_id
CREATE TABLE IF NOT EXISTS ideas (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES auth.users NOT NULL,
  type TEXT NOT NULL,
  type_color TEXT NOT NULL,
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  category TEXT NOT NULL,
  edited TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()) NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()) NOT NULL
);

-- Create indexes
CREATE INDEX IF NOT EXISTS ideas_created_at_idx ON ideas(created_at DESC);
CREATE INDEX IF NOT EXISTS ideas_user_id_idx ON ideas(user_id);

-- Enable Row Level Security
ALTER TABLE ideas ENABLE ROW LEVEL SECURITY;

-- Create policies for authenticated users
CREATE POLICY "Users can view their own ideas" ON ideas FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert their own ideas" ON ideas FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can update their own ideas" ON ideas FOR UPDATE USING (auth.uid() = user_id);
CREATE POLICY "Users can delete their own ideas" ON ideas FOR DELETE USING (auth.uid() = user_id);

-- Enable realtime for ideas table
ALTER PUBLICATION supabase_realtime ADD TABLE ideas;

-- Function to handle updated_at
CREATE OR REPLACE FUNCTION handle_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = TIMEZONE('utc', NOW());
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger to automatically update updated_at
CREATE TRIGGER ideas_updated_at
  BEFORE UPDATE ON ideas
  FOR EACH ROW
  EXECUTE FUNCTION handle_updated_at();
```

### 4. Enable Email Authentication

In your Supabase dashboard:
1. Navigate to **Authentication** → **Providers**
2. Enable **Email** provider
3. Configure email templates if needed
4. Ensure **Email Confirmation** is disabled (for magic links to work immediately)
5. Set your site URL in **Authentication** → **URL Configuration**

### 5. Install Dependencies & Run

```bash
npm install
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser.

## Usage

1. **Sign In**: Click "Sign In to Get Started" and enter your email
2. **Check Email**: You'll receive a magic link - click it to authenticate
3. **Create Ideas**: Use the capture form to save new content ideas
4. **Edit/Delete**: Click on any idea card to edit or delete it
5. **Real-time Sync**: Changes automatically sync across all devices

## Architecture

### Database Schema

- **ideas**: Main table for storing content ideas
  - `id`: Auto-incrementing primary key
  - `user_id`: Foreign key to auth.users (ensures data isolation)
  - `type`: Content type (Twitter, YouTube, Newsletter, etc.)
  - `type_color`: Visual indicator color
  - `title`: Idea title
  - `description`: Detailed description
  - `category`: Content category
  - `edited`: Human-readable edit timestamp
  - `created_at`: Creation timestamp
  - `updated_at`: Last update timestamp

### Security

- **Row Level Security (RLS)**: Enabled on the ideas table
- **User Isolation**: Each user can only access their own ideas
- **Authenticated Access**: All database operations require authentication
- **Policies**: Fine-grained CRUD policies per user

### Real-time Features

- Uses Supabase Realtime for instant updates
- Subscribes to changes for the current user's ideas
- Automatic UI updates when data changes

## File Structure

```
├── app/
│   ├── auth/callback/route.ts    # OAuth callback handler
│   ├── layout.tsx                 # Root layout with AuthProvider
│   ├── page.tsx                   # Home page with Supabase integration
│   └── globals.css
├── components/
│   ├── capture-section.tsx        # Idea capture form
│   ├── content-grid.tsx           # Grid/list view of ideas
│   ├── detail-modal.tsx           # Edit idea modal
│   ├── header.tsx
│   ├── idea-card.tsx
│   ├── login-modal.tsx            # OTP login modal
│   └── toast.tsx
├── lib/
│   ├── auth-context.tsx           # Authentication context
│   └── supabase.ts                # Supabase client & types
├── supabase-schema.sql            # Database migration
└── .env.local.example             # Environment variables template
```

## Tech Stack

- **Framework**: Next.js 16 (App Router)
- **UI**: React 19, Tailwind CSS v4
- **Backend**: Supabase (PostgreSQL + Auth + Realtime)
- **Auth**: OTP Magic Links
- **TypeScript**: Strict mode enabled

## Troubleshooting

### Magic link not working
- Check your email spam folder
- Ensure email confirmation is disabled in Supabase Auth settings
- Verify the redirect URL matches your site URL

### Real-time not working
- Ensure Realtime is enabled for the `ideas` table
- Check the browser console for WebSocket connection errors
- Verify your Supabase project has Realtime enabled

### RLS policies blocking access
- Run the SQL migration again to ensure policies are created
- Check that you're authenticated in the browser
- Verify the policies match your table structure

## Development

```bash
# Install dependencies
npm install

# Run development server
npm run dev

# Build for production
npm run build

# Start production server
npm start

# Lint code
npm run lint
```
